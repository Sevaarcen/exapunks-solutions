; THIS IS THE ORIGIN EXA
MAKE
LINK 800

; INIT SPREAD
REPL MOVE1POS
REPL MOVE3POS
REPL MOVE3NEG
REPL POSTMOVE

; WAIT TO SPREAD
COPY 25 X
MARK WAITER
SUBI X 1 X
TEST X = 0
FJMP WAITER

MARK GETNERVCOUNT
VOID M; READ JUNK DATA
ADDI X 1 X
TEST MRD; ANOTHER ALIVE
TJMP GETNERVCOUNT

COPY X F
MARK SENDWAITS
MULI X 5 M
SUBI X 1 X
TEST X = 0
FJMP SENDWAITS

; GET NUM ALIVE
SEEK -9999
COPY F X
SEEK -9999

MARK READDAT
COPY M F; RECV HOSTNAME
COPY M F; RECV NERV
SUBI X 1 X
TEST X = 0
FJMP READDAT

; DATA GATHERED
; TIME TO SORT
LINK -1
REPL FINALHOLDER

;==================
; BUBBLE SORT HERE
;==================
MARK BUBBLESORT
SEEK -9999

TEST EOF; NOTHING LEFT
TJMP ENDALL

COPY F X; ASSUME 1ST <
MARK FINDLOWEST
SEEK 1; GOTO END OF ENTR

TEST EOF; SEE IF ONLY EN
TJMP ENDITER

TEST F < X; NEW LOWEST
FJMP FINDLOWEST
SEEK -1; NEW LOWEST
COPY F X
JUMP FINDLOWEST

;==================
; LOWEST FOUND
; SEND DATA AND RESTART
;==================
MARK ENDITER
SEEK -9999
MARK REFINDLOW
TEST F = X
FJMP REFINDLOW
COPY X M
COPY F M
SEEK -2
VOID F
VOID F
JUMP BUBBLESORT

;==================
; NO MORE DATA
; STOP ALL
;==================
MARK ENDALL
WIPE
KILL
HALT

; STORE SORTED LIST
MARK FINALHOLDER
MAKE
MARK FINALLOOP
COPY M F
JUMP FINALLOOP

MARK MOVE1POS
LINK 1
REPL MOVE1POS
REPL MOVE3POS
REPL MOVE3NEG
JUMP POSTMOVE

MARK MOVE1NEG
LINK -1
REPL MOVE1NEG
REPL MOVE3POS
REPL MOVE3NEG
JUMP POSTMOVE

MARK MOVE3NEG
LINK -3
REPL MOVE1NEG
REPL MOVE1POS
REPL MOVE3NEG
JUMP POSTMOVE


MARK MOVE3POS
LINK 3
REPL MOVE1NEG
REPL MOVE1POS
REPL MOVE3POS
JUMP POSTMOVE

MARK POSTMOVE
COPY #NERV M; ALIVE MSG

MARK WAITRECV
COPY 20 X
MARK WAITRECVLOOP
SUBI X 1 X
TEST X = 0
FJMP WAITRECVLOOP

COPY M X; TRANSMIT ORDER

MARK WAITTURN
SUBI X 1 X
TEST X = 0
NOOP
FJMP WAITTURN

; SEND DATA AND DIE
HOST M
COPY #NERV M
HALT