; THIS IS THE CONTROLLER
; FINDS VALUES AND MAKES
; EXA PAWNS THAT CARRY
; OUT IT"S INSTRUCTIONS

LINK 800
LINK 801
GRAB 200

MARK BEGFINORIG
COPY M X
MARK FINDORIGNAME
TEST F = X
SEEK 10
TJMP ORIGFOUND
JUMP FINDORIGNAME

MARK BEGFINDEST
COPY M X
MARK FINDDESTNAME
TEST F = X
SEEK 10
TJMP DESTFOUND
JUMP FINDDESTNAME

MARK ORIGFOUND
SEEK -10
SEEK M
COPY F X
REPL COPYORIGIN
SEEK -9999
JUMP BEGFINDEST


MARK DESTFOUND
SEEK -10
SEEK M
COPY F X
REPL COPYDEST
SEEK -9999
JUMP BEGFINORIG


MARK COPYORIGIN
MODE; GLOBAL -> LOCAL
; GOTO DRIVE
LINK -1
SWIZ X 3 T
ADDI T 800 T
LINK T

REPL CREATEBUFFER
SWIZ X 2 T
ADDI T 200 T
GRAB T; GRAB ORIGIN FILE
SWIZ X 1 T
MULI T 10 T
SEEK T ; GOTO OFFSET
COPY 0 X
MARK BUFFCOP
COPY F M
ADDI X 1 X
TEST X = 10
FJMP BUFFCOP
HALT

MARK CREATEBUFFER
MAKE
COPY 0 X
MARK FILLBUFF
COPY M F
ADDI X 1 X
TEST X = 10
FJMP FILLBUFF
LINK -1
LINK -1
COPY M X ; RECV DESTINAT
LINK 800
LINK X ; GOTO DESTINAT
COPY 0 X
SEEK -9999
MARK TRANBUFF
COPY F M
ADDI X 1 X
TEST X = 10
FJMP TRANBUFF
WIPE
HALT


MARK COPYDEST
MODE; GLOBAL -> LOCAL
SWIZ X 3 T
ADDI T 800 T
LINK -1
LINK -1
COPY T M ; TRAN DESTINAT
LINK 800
LINK T ; GOTO DESTINAT
SWIZ X 2 T
ADDI T 200 T
GRAB T ; PICKUP FILE
SWIZ X 1 T
MULI T 10 T
SEEK T ; GOTO OFFSET
COPY 0 X
MARK OVERWRITE
COPY M F
ADDI X 1 X
TEST X = 10
FJMP OVERWRITE
DROP ; FINISH CYCLE
LINK -1
COPY -9999 M ; MX DONE